# è¯•å·ç¼–è¾‘å™¨å®ç°æ–¹æ¡ˆè®¨è®º

## ä¸€ã€éœ€æ±‚æ¢³ç†

### 1.1 å¬åŠ›é¢˜ç¼–è¾‘éœ€æ±‚

| éœ€æ±‚ | è¯´æ˜ |
|------|------|
| éŸ³é¢‘ä½ç½® | å¯æ”¾åœ¨é¢˜å¹²ä¸Šæ–¹æˆ–ä¸‹æ–¹ |
| é¢˜å¹²å¯Œæ–‡æœ¬ | æ”¯æŒåŠ ç²—ã€å˜è‰²ã€ä¸‹åˆ’çº¿ç­‰ |
| ç­”æ¡ˆå¯Œæ–‡æœ¬ | åŒæ ·æ”¯æŒå¯Œæ–‡æœ¬ |
| é€‰é¡¹æ ¼å¼ | æ”¯æŒ ABCD æˆ– 1234 |

### 1.2 å£è¯­é¢˜ç¼–è¾‘éœ€æ±‚

| éœ€æ±‚ | è¯´æ˜ |
|------|------|
| å¤šæ­¥éª¤ | ç¬¬1æ­¥ â†’ ç¬¬2æ­¥ â†’ ... â†’ ç¬¬Næ­¥ |
| æ¯æ­¥ç‹¬ç«‹å†…å®¹ | æŒ‡ä»¤ã€éŸ³é¢‘ã€å›¾ç‰‡ã€æ–‡æœ¬ç­‰ |
| æ­¥éª¤å¯å¢åˆ  | åŠ¨æ€æ·»åŠ /åˆ é™¤æ­¥éª¤ |

### 1.3 æ ¸å¿ƒéœ€æ±‚ï¼šå®æ—¶é¢„è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚   è¦æ±‚ï¼š                                                         â”‚
â”‚   1. ç¼–è¾‘æ—¶å®æ—¶é¢„è§ˆæ¸²æŸ“æ•ˆæœ                                       â”‚
â”‚   2. é¢„è§ˆ UI å’Œæœ€ç»ˆè€ƒè¯• UI å®Œå…¨ä¸€è‡´                               â”‚
â”‚   3. åæœŸä¿®æ”¹ UI æ—¶ï¼Œé¢„è§ˆè‡ªåŠ¨åŒæ­¥æ›´æ–°                             â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€æ ¸å¿ƒæ¶æ„ï¼šæ•°æ®é©±åŠ¨ + ç»„ä»¶å¤ç”¨

### 2.1 æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ç¼–è¾‘é¡µé¢                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                            â”‚                                    â”‚
â”‚        ç¼–è¾‘åŒºåŸŸ             â”‚           é¢„è§ˆåŒºåŸŸ                  â”‚
â”‚                            â”‚                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  QuestionEditor    â”‚   â”‚   â”‚   QuestionRenderer         â”‚   â”‚
â”‚   â”‚  (è¡¨å•/ç¼–è¾‘å™¨)      â”‚   â”‚   â”‚   (æ¸²æŸ“ç»„ä»¶)               â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚              â”‚                  â”‚                 â”‚
â”‚             â”‚    ä¿®æ”¹      â”‚       è¯»å–       â”‚                 â”‚
â”‚             â†“              â”‚                  â†“                 â”‚
â”‚        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”            â”‚
â”‚        â”‚              questionData (JSON)          â”‚            â”‚
â”‚        â”‚              (å“åº”å¼çŠ¶æ€)                  â”‚            â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                â†“ ä¿å­˜åˆ°æ•°æ®åº“
                                â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          è€ƒè¯•é¡µé¢                                â”‚
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                  QuestionRenderer                      â”‚    â”‚
â”‚   â”‚                  (åŒä¸€å¥—æ¸²æŸ“ç»„ä»¶)                        â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å…³é”®è®¾è®¡ï¼šæ¸²æŸ“ç»„ä»¶å¤ç”¨

```
é¢„è§ˆåŒºåŸŸ å’Œ è€ƒè¯•é¡µé¢ ä½¿ç”¨åŒä¸€å¥— QuestionRenderer ç»„ä»¶

ä¿®æ”¹ QuestionRenderer â†’ é¢„è§ˆ + è€ƒè¯• UI åŒæ—¶å˜åŒ–
```

---

## ä¸‰ã€æ•°æ®ç»“æ„è®¾è®¡

### 3.1 å¬åŠ›é€‰æ‹©é¢˜

```json
{
  "id": "q001",
  "type": "listening_choice",
  "audio": {
    "url": "https://xxx.com/audio.mp3",
    "position": "above"  // "above" | "below" - éŸ³é¢‘åœ¨é¢˜å¹²ä¸Šæ–¹è¿˜æ˜¯ä¸‹æ–¹
  },
  "stem": {
    "type": "richtext",
    "content": [
      { "type": "text", "text": "Listen and choose the " },
      { "type": "text", "text": "correct", "marks": ["bold", "underline"] },
      { "type": "text", "text": " answer." }
    ]
  },
  "optionStyle": "ABCD",  // "ABCD" | "1234"
  "subQuestions": [
    {
      "id": "sq1",
      "stem": {
        "type": "richtext",
        "content": [
          { "type": "text", "text": "What color is the cat?" }
        ]
      },
      "options": [
        {
          "key": "A",
          "content": {
            "type": "richtext",
            "content": [
              { "type": "text", "text": "Black", "marks": ["color:red"] }
            ]
          }
        },
        {
          "key": "B",
          "content": {
            "type": "richtext",
            "content": [{ "type": "text", "text": "White" }]
          }
        }
      ],
      "answer": "A"
    }
  ]
}
```

### 3.2 å£è¯­é¢˜ï¼ˆå¤šæ­¥éª¤ï¼‰

```json
{
  "id": "q002",
  "type": "speaking_steps",
  "totalSteps": 3,
  "steps": [
    {
      "step": 1,
      "title": "å¬é¢˜å‡†å¤‡",
      "elements": [
        {
          "type": "instruction",
          "content": {
            "type": "richtext",
            "content": [
              { "type": "text", "text": "Listen to the question and " },
              { "type": "text", "text": "prepare", "marks": ["bold"] },
              { "type": "text", "text": " your answer." }
            ]
          }
        },
        {
          "type": "audio",
          "url": "https://xxx.com/prompt.mp3",
          "autoPlay": true
        }
      ],
      "prepareTime": 10,
      "recordTime": 0
    },
    {
      "step": 2,
      "title": "å›ç­”é—®é¢˜",
      "elements": [
        {
          "type": "instruction",
          "content": {
            "type": "richtext",
            "content": [{ "type": "text", "text": "Now please answer." }]
          }
        }
      ],
      "prepareTime": 0,
      "recordTime": 30
    },
    {
      "step": 3,
      "title": "æœ—è¯»çŸ­æ–‡",
      "elements": [
        {
          "type": "instruction",
          "content": {
            "type": "richtext",
            "content": [{ "type": "text", "text": "Read the passage aloud." }]
          }
        },
        {
          "type": "passage",
          "content": {
            "type": "richtext",
            "content": [
              { "type": "text", "text": "The Great Wall is one of the most " },
              { "type": "text", "text": "famous", "marks": ["underline"] },
              { "type": "text", "text": " landmarks in China." }
            ]
          }
        }
      ],
      "prepareTime": 15,
      "recordTime": 60
    }
  ]
}
```

### 3.3 å¯Œæ–‡æœ¬ç»“æ„

```json
{
  "type": "richtext",
  "content": [
    { "type": "text", "text": "æ™®é€šæ–‡æœ¬" },
    { "type": "text", "text": "åŠ ç²—", "marks": ["bold"] },
    { "type": "text", "text": "ä¸‹åˆ’çº¿", "marks": ["underline"] },
    { "type": "text", "text": "çº¢è‰²", "marks": ["color:#ff0000"] },
    { "type": "text", "text": "ç»„åˆæ ·å¼", "marks": ["bold", "underline", "color:#0066cc"] }
  ]
}
```

æ”¯æŒçš„ marksï¼š
- `bold` - åŠ ç²—
- `italic` - æ–œä½“
- `underline` - ä¸‹åˆ’çº¿
- `color:#xxxxxx` - æ–‡å­—é¢œè‰²
- `bg:#xxxxxx` - èƒŒæ™¯è‰²

---

## å››ã€é¡¹ç›®ç»“æ„è®¾è®¡

```
src/
â”œâ”€â”€ components/
â”‚   â”‚
â”‚   â”œâ”€â”€ renderer/                    # ğŸ¯ æ¸²æŸ“ç»„ä»¶ï¼ˆé¢„è§ˆ+è€ƒè¯•å…±ç”¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ QuestionRenderer.vue     # é¢˜ç›®æ¸²æŸ“å…¥å£
â”‚   â”‚   â”œâ”€â”€ ListeningChoiceRenderer.vue
â”‚   â”‚   â”œâ”€â”€ ListeningFillRenderer.vue
â”‚   â”‚   â”œâ”€â”€ SpeakingStepsRenderer.vue
â”‚   â”‚   â”œâ”€â”€ RichTextRenderer.vue     # å¯Œæ–‡æœ¬æ¸²æŸ“
â”‚   â”‚   â””â”€â”€ AudioPlayer.vue          # éŸ³é¢‘æ’­æ”¾å™¨
â”‚   â”‚
â”‚   â””â”€â”€ editor/                      # ğŸ“ ç¼–è¾‘ç»„ä»¶ï¼ˆä»…ç¼–è¾‘å™¨ç”¨ï¼‰
â”‚       â”œâ”€â”€ QuestionEditor.vue       # é¢˜ç›®ç¼–è¾‘å…¥å£
â”‚       â”œâ”€â”€ ListeningChoiceEditor.vue
â”‚       â”œâ”€â”€ SpeakingStepsEditor.vue
â”‚       â”œâ”€â”€ RichTextEditor.vue       # å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
â”‚       â”œâ”€â”€ AudioUploader.vue        # éŸ³é¢‘ä¸Šä¼ 
â”‚       â””â”€â”€ OptionEditor.vue         # é€‰é¡¹ç¼–è¾‘
â”‚
â”œâ”€â”€ views/
â”‚   â”œâ”€â”€ EditorPage.vue               # ç¼–è¾‘é¡µé¢ï¼ˆç¼–è¾‘å™¨ + é¢„è§ˆï¼‰
â”‚   â””â”€â”€ ExamPage.vue                 # è€ƒè¯•é¡µé¢ï¼ˆåªæœ‰æ¸²æŸ“å™¨ï¼‰
â”‚
â”œâ”€â”€ stores/
â”‚   â””â”€â”€ questionStore.js             # é¢˜ç›®çŠ¶æ€ç®¡ç†
â”‚
â””â”€â”€ styles/
    â””â”€â”€ question.scss                # é¢˜ç›®æ ·å¼ï¼ˆæ¸²æŸ“å™¨ç”¨ï¼‰
```

---

## äº”ã€æ ¸å¿ƒç»„ä»¶å®ç°

### 5.1 ç¼–è¾‘é¡µé¢å¸ƒå±€

```vue
<!-- EditorPage.vue -->
<template>
  <div class="editor-page">
    <!-- å·¦ä¾§ï¼šç¼–è¾‘åŒº -->
    <div class="editor-panel">
      <QuestionEditor v-model="questionData" />
    </div>

    <!-- å³ä¾§ï¼šå®æ—¶é¢„è§ˆ -->
    <div class="preview-panel">
      <div class="preview-header">å®æ—¶é¢„è§ˆ</div>
      <div class="preview-content">
        <!-- ğŸ¯ å…³é”®ï¼šä½¿ç”¨åŒä¸€å¥—æ¸²æŸ“ç»„ä»¶ -->
        <QuestionRenderer :data="questionData" mode="preview" />
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, watch } from 'vue'
import QuestionEditor from '@/components/editor/QuestionEditor.vue'
import QuestionRenderer from '@/components/renderer/QuestionRenderer.vue'

const questionData = ref({
  type: 'listening_choice',
  // ... åˆå§‹æ•°æ®
})

// æ•°æ®å˜åŒ–æ—¶è‡ªåŠ¨è§¦å‘é¢„è§ˆæ›´æ–°ï¼ˆVue å“åº”å¼è‡ªåŠ¨å¤„ç†ï¼‰
</script>
```

### 5.2 é¢˜ç›®æ¸²æŸ“å™¨ï¼ˆå…³é”®ç»„ä»¶ï¼‰

```vue
<!-- QuestionRenderer.vue -->
<template>
  <div class="question-renderer">
    <!-- æ ¹æ®é¢˜å‹åŠ¨æ€æ¸²æŸ“ -->
    <component :is="rendererComponent" :data="data" :mode="mode" />
  </div>
</template>

<script setup>
import { computed } from 'vue'
import ListeningChoiceRenderer from './ListeningChoiceRenderer.vue'
import ListeningFillRenderer from './ListeningFillRenderer.vue'
import SpeakingStepsRenderer from './SpeakingStepsRenderer.vue'

const props = defineProps({
  data: { type: Object, required: true },
  mode: { type: String, default: 'exam' }  // 'preview' | 'exam'
})

const rendererComponent = computed(() => {
  const map = {
    'listening_choice': ListeningChoiceRenderer,
    'listening_fill': ListeningFillRenderer,
    'speaking_steps': SpeakingStepsRenderer,
  }
  return map[props.data.type]
})
</script>
```

### 5.3 å¬åŠ›é€‰æ‹©é¢˜æ¸²æŸ“å™¨

```vue
<!-- ListeningChoiceRenderer.vue -->
<template>
  <div class="listening-choice">
    <!-- éŸ³é¢‘ï¼ˆæ ¹æ® position å†³å®šä½ç½®ï¼‰ -->
    <AudioPlayer
      v-if="data.audio?.position === 'above'"
      :src="data.audio.url"
    />

    <!-- é¢˜å¹² -->
    <div class="stem">
      <RichTextRenderer :content="data.stem" />
    </div>

    <!-- éŸ³é¢‘ï¼ˆä¸‹æ–¹ï¼‰ -->
    <AudioPlayer
      v-if="data.audio?.position === 'below'"
      :src="data.audio.url"
    />

    <!-- å­é¢˜åˆ—è¡¨ -->
    <div class="sub-questions">
      <div
        v-for="(sq, index) in data.subQuestions"
        :key="sq.id"
        class="sub-question"
      >
        <div class="sq-stem">
          <span class="sq-number">{{ index + 1 }}.</span>
          <RichTextRenderer :content="sq.stem" />
        </div>

        <div class="options" :class="data.optionStyle">
          <div
            v-for="opt in sq.options"
            :key="opt.key"
            class="option"
            :class="{ selected: isSelected(sq.id, opt.key) }"
            @click="selectOption(sq.id, opt.key)"
          >
            <span class="option-key">{{ formatKey(opt.key) }}</span>
            <RichTextRenderer :content="opt.content" />
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import AudioPlayer from './AudioPlayer.vue'
import RichTextRenderer from './RichTextRenderer.vue'

const props = defineProps({
  data: Object,
  mode: String
})

// é€‰é¡¹æ ¼å¼åŒ–ï¼šABCD æˆ– 1234
function formatKey(key) {
  if (props.data.optionStyle === '1234') {
    return { 'A': '1', 'B': '2', 'C': '3', 'D': '4' }[key] || key
  }
  return key
}
</script>
```

### 5.4 å¯Œæ–‡æœ¬æ¸²æŸ“å™¨

```vue
<!-- RichTextRenderer.vue -->
<template>
  <span class="rich-text">
    <span
      v-for="(node, index) in content.content"
      :key="index"
      :style="getStyle(node.marks)"
      :class="getClass(node.marks)"
    >
      {{ node.text }}
    </span>
  </span>
</template>

<script setup>
const props = defineProps({
  content: Object
})

function getStyle(marks = []) {
  const style = {}
  marks.forEach(mark => {
    if (mark.startsWith('color:')) {
      style.color = mark.split(':')[1]
    }
    if (mark.startsWith('bg:')) {
      style.backgroundColor = mark.split(':')[1]
    }
  })
  return style
}

function getClass(marks = []) {
  return {
    'bold': marks.includes('bold'),
    'italic': marks.includes('italic'),
    'underline': marks.includes('underline')
  }
}
</script>

<style scoped>
.bold { font-weight: bold; }
.italic { font-style: italic; }
.underline { text-decoration: underline; }
</style>
```

### 5.5 å¯Œæ–‡æœ¬ç¼–è¾‘å™¨

```vue
<!-- RichTextEditor.vue -->
<template>
  <div class="rich-text-editor">
    <!-- å·¥å…·æ  -->
    <div class="toolbar">
      <button @click="toggleMark('bold')" :class="{ active: hasMark('bold') }">
        <b>B</b>
      </button>
      <button @click="toggleMark('underline')" :class="{ active: hasMark('underline') }">
        <u>U</u>
      </button>
      <input type="color" @change="setColor" title="æ–‡å­—é¢œè‰²" />
    </div>

    <!-- ç¼–è¾‘åŒºåŸŸ -->
    <div
      ref="editorRef"
      class="editor-content"
      contenteditable
      @input="onInput"
      @mouseup="updateSelection"
    />
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'

const props = defineProps({
  modelValue: Object
})
const emit = defineEmits(['update:modelValue'])

// ä½¿ç”¨ç°æˆçš„å¯Œæ–‡æœ¬åº“æ›´å¥½ï¼šTipTap / Quill / Slate
// è¿™é‡Œåªæ˜¯ç¤ºæ„ç®€å•å®ç°
</script>
```

---

## å…­ã€å¯Œæ–‡æœ¬ç¼–è¾‘å™¨é€‰å‹

### 6.1 æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåº¦ |
|------|------|------|--------|
| **TipTap** | Vue å‹å¥½ã€å¯æ‰©å±•ã€æ•°æ®ç»“æ„åŒ– | å­¦ä¹ æˆæœ¬ä¸­ç­‰ | â­â­â­â­â­ |
| **Quill** | ç®€å•æ˜“ç”¨ã€æ–‡æ¡£ä¸°å¯Œ | å®šåˆ¶æ€§ç¨å·® | â­â­â­â­ |
| Slate.js | æåº¦çµæ´» | React ç”Ÿæ€ã€å¤æ‚ | â­â­â­ |
| CKEditor | åŠŸèƒ½å…¨é¢ | å¤ªé‡ã€å•†ä¸šæˆæƒ | â­â­ |
| åŸç”Ÿ contenteditable | æ— ä¾èµ– | å·¥ä½œé‡å¤§ã€å‘å¤š | â­ |

### 6.2 æ¨èï¼šTipTap

```javascript
// TipTap è¾“å‡ºçš„ JSON ç»“æ„ï¼ˆä¸æˆ‘ä»¬è®¾è®¡çš„ç±»ä¼¼ï¼‰
{
  "type": "doc",
  "content": [
    {
      "type": "paragraph",
      "content": [
        { "type": "text", "text": "æ™®é€šæ–‡æœ¬" },
        {
          "type": "text",
          "text": "åŠ ç²—æ–‡æœ¬",
          "marks": [{ "type": "bold" }]
        }
      ]
    }
  ]
}
```

**TipTap é›†æˆç¤ºä¾‹**ï¼š

```vue
<!-- RichTextEditor.vue -->
<template>
  <div class="rich-text-editor">
    <div class="toolbar">
      <button @click="editor.chain().focus().toggleBold().run()">B</button>
      <button @click="editor.chain().focus().toggleUnderline().run()">U</button>
      <input type="color" @input="setColor($event.target.value)" />
    </div>
    <EditorContent :editor="editor" />
  </div>
</template>

<script setup>
import { useEditor, EditorContent } from '@tiptap/vue-3'
import StarterKit from '@tiptap/starter-kit'
import Underline from '@tiptap/extension-underline'
import TextStyle from '@tiptap/extension-text-style'
import Color from '@tiptap/extension-color'

const props = defineProps({ modelValue: Object })
const emit = defineEmits(['update:modelValue'])

const editor = useEditor({
  extensions: [StarterKit, Underline, TextStyle, Color],
  content: props.modelValue,
  onUpdate: ({ editor }) => {
    emit('update:modelValue', editor.getJSON())
  }
})

function setColor(color) {
  editor.value.chain().focus().setColor(color).run()
}
</script>
```

---

## ä¸ƒã€å£è¯­é¢˜å¤šæ­¥éª¤ç¼–è¾‘å™¨

### 7.1 æ­¥éª¤ç¼–è¾‘å™¨

```vue
<!-- SpeakingStepsEditor.vue -->
<template>
  <div class="speaking-steps-editor">
    <div class="steps-list">
      <div
        v-for="(step, index) in modelValue.steps"
        :key="step.step"
        class="step-item"
      >
        <div class="step-header">
          <span>ç¬¬ {{ index + 1 }} æ­¥</span>
          <input v-model="step.title" placeholder="æ­¥éª¤æ ‡é¢˜" />
          <button @click="removeStep(index)">åˆ é™¤</button>
        </div>

        <div class="step-content">
          <!-- æŒ‡ä»¤æ–‡æœ¬ -->
          <div class="field">
            <label>æŒ‡ä»¤ï¼š</label>
            <RichTextEditor v-model="step.elements[0].content" />
          </div>

          <!-- å…ƒç´ åˆ—è¡¨ -->
          <div class="elements">
            <div v-for="(el, elIndex) in step.elements" :key="elIndex">
              <ElementEditor v-model="step.elements[elIndex]" />
            </div>
            <button @click="addElement(index)">+ æ·»åŠ å…ƒç´ </button>
          </div>

          <!-- æ—¶é—´è®¾ç½® -->
          <div class="time-settings">
            <label>
              å‡†å¤‡æ—¶é—´ï¼š
              <input type="number" v-model="step.prepareTime" /> ç§’
            </label>
            <label>
              å½•éŸ³æ—¶é—´ï¼š
              <input type="number" v-model="step.recordTime" /> ç§’
            </label>
          </div>
        </div>
      </div>
    </div>

    <button @click="addStep" class="add-step-btn">+ æ·»åŠ æ­¥éª¤</button>
  </div>
</template>

<script setup>
const props = defineProps({ modelValue: Object })
const emit = defineEmits(['update:modelValue'])

function addStep() {
  const newStep = {
    step: props.modelValue.steps.length + 1,
    title: '',
    elements: [{ type: 'instruction', content: { type: 'richtext', content: [] } }],
    prepareTime: 10,
    recordTime: 30
  }
  emit('update:modelValue', {
    ...props.modelValue,
    steps: [...props.modelValue.steps, newStep],
    totalSteps: props.modelValue.steps.length + 1
  })
}

function removeStep(index) {
  const newSteps = props.modelValue.steps.filter((_, i) => i !== index)
  emit('update:modelValue', {
    ...props.modelValue,
    steps: newSteps,
    totalSteps: newSteps.length
  })
}
</script>
```

---

## å…«ã€ä¿è¯ UI ä¸€è‡´æ€§çš„å…³é”®

### 8.1 åŸåˆ™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚   æ ¸å¿ƒåŸåˆ™ï¼šæ¸²æŸ“ç»„ä»¶åªæœ‰ä¸€å¥—ï¼Œæ‰€æœ‰åœ°æ–¹å¤ç”¨                          â”‚
â”‚                                                                  â”‚
â”‚   ç¼–è¾‘å™¨é¢„è§ˆ â”€â”€â”                                                  â”‚
â”‚               â”œâ”€â”€â†’ QuestionRenderer â”€â”€â†’ ç»Ÿä¸€æ ·å¼                 â”‚
â”‚   è€ƒè¯•é¡µé¢ â”€â”€â”€â”˜                                                   â”‚
â”‚                                                                  â”‚
â”‚   ä¿®æ”¹ QuestionRenderer = æ‰€æœ‰åœ°æ–¹éƒ½å˜                            â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 æ ·å¼ç®¡ç†

```scss
// styles/question.scss - ç»Ÿä¸€æ ·å¼æ–‡ä»¶

.question-renderer {
  // åŸºç¡€æ ·å¼
  font-size: 16px;
  line-height: 1.6;

  .stem {
    margin-bottom: 16px;
    font-weight: 500;
  }

  .options {
    display: flex;
    flex-direction: column;
    gap: 12px;

    &.ABCD .option-key::after { content: '.'; }
    &.1234 .option-key::after { content: '.'; }
  }

  .option {
    display: flex;
    align-items: center;
    padding: 12px;
    border-radius: 8px;
    cursor: pointer;

    &:hover { background: #f5f5f5; }
    &.selected { background: #e3f2fd; border: 1px solid #2196f3; }
    &.correct { background: #e8f5e9; }
    &.wrong { background: #ffebee; }
  }
}

// é¢„è§ˆæ¨¡å¼é¢å¤–æ ·å¼
.preview-panel .question-renderer {
  // å¯ä»¥åŠ è¾¹æ¡†è¡¨ç¤ºæ˜¯é¢„è§ˆ
  border: 1px dashed #ccc;
  padding: 16px;
}
```

### 8.3 ç›®å½•ç»“æ„å¼ºè°ƒ

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ renderer/        # âš ï¸ è¿™é‡Œçš„ç»„ä»¶æ˜¯å…±ç”¨çš„
â”‚   â”‚   â””â”€â”€ ...          #    ä¿®æ”¹è¿™é‡Œ = é¢„è§ˆ+è€ƒè¯•éƒ½å˜
â”‚   â”‚
â”‚   â””â”€â”€ editor/          # è¿™é‡Œåªæ˜¯ç¼–è¾‘å™¨ç”¨
â”‚       â””â”€â”€ ...
â”‚
â””â”€â”€ styles/
    â””â”€â”€ question.scss    # âš ï¸ æ ·å¼ä¹Ÿæ˜¯å…±ç”¨çš„
```

---

## ä¹ã€å®ç°æ­¥éª¤å»ºè®®

### Phase 1ï¼šåŸºç¡€æ¶æ„
1. ç¡®å®šæ•°æ®ç»“æ„ï¼ˆJSON Schemaï¼‰
2. å®ç° QuestionRenderer åŸºç¡€ç‰ˆæœ¬
3. å®ç°ç¼–è¾‘é¡µé¢å·¦å³å¸ƒå±€

### Phase 2ï¼šå¯Œæ–‡æœ¬
1. é›†æˆ TipTap
2. å®ç° RichTextRenderer
3. å®ç° RichTextEditor
4. æ”¯æŒåŠ ç²—ã€é¢œè‰²ã€ä¸‹åˆ’çº¿

### Phase 3ï¼šé¢˜å‹ç¼–è¾‘å™¨
1. å¬åŠ›é€‰æ‹©é¢˜ç¼–è¾‘å™¨
2. å¬åŠ›å¡«ç©ºé¢˜ç¼–è¾‘å™¨
3. å£è¯­å¤šæ­¥éª¤ç¼–è¾‘å™¨

### Phase 4ï¼šå®Œå–„
1. éŸ³é¢‘ä¸Šä¼ ç»„ä»¶
2. å›¾ç‰‡ä¸Šä¼ ç»„ä»¶
3. æ‹–æ‹½æ’åº
4. æ•°æ®æ ¡éªŒ

---

## åã€æ€»ç»“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚   å®ç°å®æ—¶é¢„è§ˆçš„å…³é”®ï¼š                                            â”‚
â”‚                                                                  â”‚
â”‚   1. æ•°æ®é©±åŠ¨ï¼šç¼–è¾‘å™¨ä¿®æ”¹ JSONï¼Œé¢„è§ˆè¯»å– JSON                      â”‚
â”‚                                                                  â”‚
â”‚   2. ç»„ä»¶å¤ç”¨ï¼šé¢„è§ˆå’Œè€ƒè¯•ä½¿ç”¨åŒä¸€å¥— Renderer ç»„ä»¶                  â”‚
â”‚                                                                  â”‚
â”‚   3. æ ·å¼ç»Ÿä¸€ï¼šRenderer ç»„ä»¶çš„æ ·å¼æ–‡ä»¶åªæœ‰ä¸€ä»½                     â”‚
â”‚                                                                  â”‚
â”‚   è¿™æ ·ä¿è¯ï¼šæ”¹ UI = æ”¹ Renderer = é¢„è§ˆ + è€ƒè¯•åŒæ—¶å˜åŒ–              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚   å¯Œæ–‡æœ¬æ–¹æ¡ˆï¼š                                                    â”‚
â”‚                                                                  â”‚
â”‚   æ¨èä½¿ç”¨ TipTapï¼ˆVue ç”Ÿæ€æœ€ä½³é€‰æ‹©ï¼‰                              â”‚
â”‚   - è¾“å‡ºç»“æ„åŒ– JSON                                               â”‚
â”‚   - æ”¯æŒè‡ªå®šä¹‰æ‰©å±•                                                â”‚
â”‚   - ä¸ Vue 3 å®Œç¾é›†æˆ                                             â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åä¸€ã€å¾…è®¨è®º

1. **å¯Œæ–‡æœ¬ç¼–è¾‘å™¨é€‰å‹**ï¼šTipTap / Quill / å…¶ä»–ï¼Ÿ
2. **éŸ³é¢‘å­˜å‚¨æ–¹æ¡ˆ**ï¼šOSS / è‡ªå»ºå­˜å‚¨ï¼Ÿ
3. **æ˜¯å¦éœ€è¦ååŒç¼–è¾‘**ï¼šå¤šäººåŒæ—¶ç¼–è¾‘ä¸€é“é¢˜ï¼Ÿ
4. **ç‰ˆæœ¬å†å²**ï¼šæ˜¯å¦éœ€è¦é¢˜ç›®ä¿®æ”¹å†å²ï¼Ÿ
5. **æ¨¡æ¿åŠŸèƒ½**ï¼šæ˜¯å¦éœ€è¦é¢˜ç›®æ¨¡æ¿å¿«é€Ÿåˆ›å»ºï¼Ÿ

---

*æ–‡æ¡£åˆ›å»ºæ—¶é—´ï¼š2025-01-16*
