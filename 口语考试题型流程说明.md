# 口语考试题型流程说明

本文档详细描述 `ExamBeginVC.m` 中各口语题型的完整流程，包括每一步的操作和界面显示。

> 文件位置：`Controllers/Exam/Controller/ExamBeginVC.m`（约 390KB，超大文件）

---

## 目录

1. [整体架构](#整体架构)
2. [题型索引](#题型索引)
3. [partType = 1：短文朗读](#parttype--1短文朗读)
4. [partType = 2：口头选择](#parttype--2口头选择多项选择)
5. [partType = 3：情景问答](#parttype--3情景问答)
6. [partType = 4：口头作文](#parttype--4口头作文)
7. [partType = 5：听后转述](#parttype--5听后转述)
8. [partType = 6：单句练习](#parttype--6单句练习)
9. [partType = 7：单词朗读](#parttype--7单词朗读)
10. [partType = 8：朗读短文并回答问题](#parttype--8朗读短文并回答问题)
11. [partType = 12：转述阅读](#parttype--12转述阅读)
12. [通用组件详解](#通用-ui-组件说明)
13. [录音引擎详解](#录音引擎详解)
14. [状态机说明](#状态机说明)
15. [错误处理](#错误处理)

---

## 题型索引

### 口语题型（本文档重点）

| partType | 题型名称 | 交互方式 | 评测模式 |
|----------|---------|---------|---------|
| 0 | 大题分隔符 | 无 | - |
| 1 | 短文朗读 | 录音 | E模式（文章朗读） |
| 2 | 口头选择 | 录音 | H模式（多选） |
| 3 | 情景问答 | 录音 | B模式（JSGF语法） |
| 4 | 口头作文 | 录音 | C模式（转述） |
| 5 | 听后转述 | 填空+录音 | C模式（转述） |
| 6 | 单句练习 | 录音 | E模式（文章朗读） |
| 7 | 单词朗读 | 录音 | G模式（单词+音标） |
| 8 | 朗读短文并回答问题 | 录音 | E模式+B模式 |
| 12 | 转述阅读 | 录音 | C模式（转述） |

### 听力/笔试题型（简要）

| partType | 题型名称 | 交互方式 |
|----------|---------|---------|
| 10001~20002 | 听力/阅读选择、连线、排序、填空等 | 点击/拖拽/输入 |

---

## 整体架构

### 界面布局
- **上区域（tableView）**：显示题目内容、题目文本、图片等
- **下区域（bottomView）**：显示控制组件，如播放进度条、倒计时、录音状态等
- **导航栏**：包含返回按钮、提交按钮
- **底部按钮栏**：包含"下一步"、"下一大题"按钮

### 通用流程
1. **题型介绍页**（`ExamQuestionTypeIntrducationView`）：显示题型说明，播放描述音频
2. **题目展示**：在 tableView 中显示题目内容
3. **答题阶段**：根据题型进行录音/选择/填写
4. **评测/提交**：引擎评测或直接进入下一题

---

## partType = 1：短文朗读

### 流程步骤

| 步骤 | 操作 | 上区域显示 | 下区域显示 |
|------|------|-----------|-----------|
| 1 | 题型介绍 | 无 | 介绍页（题型说明+GIF动画） |
| 2 | 播放示范音频 | 短文内容（`OralExamReadAloudCell`） | 音频播放器（`OralExamPlaySysReadSoundVC`）：进度条+播放时长 |
| 3 | 阅读准备（如有readTimes） | 短文内容 | 倒计时界面（`OralExamReadQuestionVC`）：倒计时+进度条+"开始录音"按钮 |
| 4 | 开始录音 | 短文内容 | 录音状态（`OralExamRecordVC`）："正在录音中 XXs"+"录音完成"按钮 |
| 5 | 评测打分 | 短文内容 | 显示 HUD "正在评测中，请稍候" |
| 6 | 进入下一题 | - | - |

### 关键方法
```objc
- (void)partOnePlayEnd:           // 音频播放完成处理
- (void)partOneBeginReadCountDownTimer:  // 阅读准备倒计时
- (void)partOneBeginRecord        // 开始录音计时
- (void)partOneBeginReadTextMethods:     // 启动录音引擎
```

---

## partType = 2：口头选择（多项选择）

### 流程步骤

| 步骤 | 操作 | 上区域显示 | 下区域显示 |
|------|------|-----------|-----------|
| 1 | 题型介绍 | 无 | 介绍页 |
| 2 | 阅读题目（如有readTimes） | 所有小题列表（`OralExamPartFiveCell`） | 倒计时（`OralExamPartTheReadVC`）："请认真阅读问题，X秒后播放对话音频..." |
| 3 | 播放对话音频（voice） | 所有小题列表 | 音频播放器（`OralExamPartThrPlayQuestionVC`） |
| 4 | 逐题回答 - 播放小题音频 | 当前小题+选项（`OralExamChooseQuestionCell`） | 音频播放器 |
| 5 | 逐题回答 - 录音作答 | 当前小题+选项 | 录音状态："正在录音中 XXs" |
| 6 | 评测打分 | 当前小题 | HUD "正在评测中" |
| 7 | 循环步骤4-6直到所有小题完成 | - | - |

### 上区域详细
- **未开始小题时**：显示所有小题题目列表
- **开始答题后**：只显示当前小题及其选项（A/B/C/D）

### 关键方法
```objc
- (void)partTwoPlayEnd:              // 处理各阶段转换
- (void)partTwoBeginReadTextMethods: // 启动选择题录音
```

---

## partType = 3：情景问答

### 流程步骤

| 步骤 | 操作 | 上区域显示 | 下区域显示 |
|------|------|-----------|-----------|
| 1 | 题型介绍 | 无 | 介绍页 |
| 2 | 阅读题目（如有readTimes） | Header：情景提示（prompt）+ 图片；Row：所有小题列表 | 倒计时："请认真阅读问题，X秒后播放对话音频..." |
| 3 | 播放对话音频（voice） | 情景提示 + 小题列表 | 音频播放器 |
| 4 | 逐题回答 - 播放问题音频 | 当前小题（`CTExamRevisalShowQuestionsCell`） | 音频播放器 |
| 5 | 逐题回答 - 录音作答 | 当前小题 | 录音状态 |
| 6 | 评测打分（使用关键词评分） | 当前小题 | HUD |
| 7 | 循环直到所有小题完成 | - | - |

### 评测模式
- 使用 JSGF 语法进行评测
- 支持多个正确答案（用 `|` 分隔）
- 支持关键词权重评分（`GrammarWeight`）

---

## partType = 4：口头作文

### 流程步骤

| 步骤 | 操作 | 上区域显示 | 下区域显示 |
|------|------|-----------|-----------|
| 1 | 题型介绍 | 无 | 介绍页 |
| 2 | 阅读信息（如有readTimes） | 题目要求+提示信息（`CTExamRevisalShowQuestionsCell`） | 倒计时："请认真阅读以上信息" |
| 3 | 播放提示音频（如有voice） | 题目要求 | 音频播放器 |
| 4 | 开始录音 | 题目要求 | 录音状态："正在录音中 XXs" |
| 5 | 评测打分 | 题目要求 | HUD |

### 评测模式
- 使用 `en.exam.retell` 评测类型
- 支持多个参考答案进行匹配评分

---

## partType = 5：听后转述

### 流程步骤（最复杂的题型）

| 步骤 | 操作 | 上区域显示 | 下区域显示 |
|------|------|-----------|-----------|
| 1 | 题型介绍 | 无 | 介绍页 |
| 2 | 播放第一段描述音频 | Header：第一段描述；Row：填空题列表（`OralExamPartFiveCell`） | 音频播放器 + 填空答题区（`OralExamPartFiveAnswerView`） |
| 3 | 阅读准备（如有readTimes） | 填空题列表 | 倒计时："你有X秒时间浏览提示信息" |
| 4 | 播放录音（多遍，firstCount次） | 填空题列表 | 音频播放器："第X遍播放..." |
| 5 | 播放准备音频（firstPrepareVoice） | 填空题列表 + Section1：提示信息 | 音频播放器 |
| 6 | 答题时间（填空） | 填空题列表 | 倒计时："答题时间..." |
| 7 | 播放第二段描述音频 | Header：第二段描述 | 音频播放器 |
| 8 | 再次播放录音（secondCount次） | 第二段描述 | 音频播放器："听后转述：请听第X遍录音..." |
| 9 | 转述准备（secondReadyTimes） | 第二段描述 | 倒计时："转述准备..." |
| 10 | 播放"嘀"声提示 | 第二段描述 | 录音状态（隐藏） |
| 11 | 开始录音转述 | 第二段描述 | 录音状态："正在录音中 XXs" |
| 12 | 评测打分 | - | HUD |

### 界面结构
- **Section 0**：Header显示描述信息，Rows显示填空题列表
- **Section 1**（准备阶段后出现）：显示提示信息

---

## partType = 6：单句练习

### 流程步骤

| 步骤 | 操作 | 上区域显示 | 下区域显示 |
|------|------|-----------|-----------|
| 1 | 题型介绍 | 无 | 介绍页 |
| 2 | 随机打乱句子顺序 | 随机排序后的句子列表（`CTExamRevisalShowSixQuestionsCell`） | - |
| 3 | 播放示范音频（如有voice） | 句子列表 | 音频播放器 |
| 4 | 阅读准备（如有readTimes） | 句子列表 | 倒计时界面 |
| 5 | 开始录音（所有句子连读） | 句子列表 | 录音状态 |
| 6 | 评测打分 | 句子列表 | HUD |

### 特殊处理
- 句子顺序会被随机打乱（`randomPartSixArrayMethods`）
- 所有句子作为一个整体进行录音和评测

---

## partType = 7：单词朗读

### 流程步骤

| 步骤 | 操作 | 上区域显示 | 下区域显示 |
|------|------|-----------|-----------|
| 1 | 题型介绍 | 无 | 介绍页 |
| 2 | 显示单词（熟悉时间） | 自定义单词展示视图（`OralExamWordView`）：单词+音标+图片 | 倒计时 |
| 3 | 开始录音 | 单词展示视图："单词朗读(1/N)" | 录音状态 |
| 4 | 评测打分 | 单词展示视图 | HUD |
| 5 | 循环2-4直到所有单词完成 | - | - |

### 界面特点
- 使用自定义全屏视图 `OralExamWordView` 覆盖 tableView
- 显示：单词文本、音标、配图、倒计时
- 录音模式：使用 G 模式（可获得音标分数）

---

## partType = 8：朗读短文并回答问题

### 流程步骤

| 步骤 | 操作 | 上区域显示 | 下区域显示 |
|------|------|-----------|-----------|
| 1 | 题型介绍 | 无 | 介绍页 |
| 2 | 播放短文音频（firstvoice） | 短文内容视图（`OralExamContentView`） | 音频播放器 |
| 3 | 浏览短文与问题（firstReadyTimes） | 短文内容 | 倒计时："你有X秒时间浏览短文与问题" |
| 4 | 播放朗读指令音频（firstDescVoice） | 短文内容 | 音频播放器 |
| 5 | 播放"嘀"声提示 | 短文内容 | 录音状态（隐藏） |
| 6 | 朗读短文录音 | 短文内容 | 录音状态："正在录音中 XXs" |
| 7 | 评测朗读打分 | 短文内容 | HUD |
| 8 | 播放问答指令音频（secondvoice） | Header：指令描述；Row：当前问题 | 音频播放器 |
| 9 | 逐题回答 - 准备（eachReadTimes） | 当前问题（`CTExamRevisalShowSixQuestionsCell`） | 倒计时 |
| 10 | 逐题回答 - 播放"嘀"声 | 当前问题 | - |
| 11 | 逐题回答 - 录音 | 当前问题 | 录音状态 |
| 12 | 评测打分 | 当前问题 | HUD |
| 13 | 循环9-12直到所有问题完成 | - | - |

### 界面结构
- 使用 `OralExamContentView` 显示短文内容
- Header 显示当前阶段的指令描述
- Row 显示当前问题（回答阶段）

---

## partType = 12：转述阅读

### 流程步骤

| 步骤 | 操作 | 上区域显示 | 下区域显示 |
|------|------|-----------|-----------|
| 1 | 题型介绍 | 无 | 介绍页 |
| 2 | 浏览材料（readTimes） | Header：题目描述+图片 | 倒计时："浏览时间" |
| 3 | 播放录音（多遍，secondCount次） | 题目描述 | 音频播放器："第X遍播放..." |
| 4 | 播放准备音频（secPrepareDescVoice） | 准备阶段描述 | 音频播放器 |
| 5 | 转述准备（secondReadyTimes） | 准备阶段描述 | 倒计时："转述准备..." |
| 6 | 播放开始音频（secStartDescVoice） | 开始阶段描述 | 音频播放器 |
| 7 | 播放"嘀"声提示 | 开始阶段描述 | 录音状态（隐藏） |
| 8 | 开始录音转述 | 开始阶段描述 | 录音状态："正在录音中 XXs" |
| 9 | 评测打分 | - | HUD |

### 界面特点
- Header 可显示图片，点击可放大查看（`ZoomImageView`）
- 根据阶段动态切换描述文本（seconddesc → secPreparedesc → secStartdesc）

---

## 通用 UI 组件说明

### 下区域子控制器

| 组件 | 功能 | 显示内容 |
|------|------|---------|
| `OralExamPlaySysReadSoundVC` | 音频播放器 | 进度条 + 开始时间 + 结束时间 + 暂停/播放按钮 |
| `OralExamReadQuestionVC` | 阅读准备 | 倒计时数字 + 进度条 + "开始录音"按钮 + 提示文字 |
| `OralExamRecordVC` | 录音状态 | 录音动画 + "正在录音中 XXs" + "录音完成"按钮 |
| `OralExamPartTheReadVC` | 通用倒计时 | 倒计时数字 + 进度条 + 提示信息 |
| `OralExamPartThrPlayQuestionVC` | 音频播放器（带提示） | 进度条 + 时间 + 播放遍数提示（"第X遍播放..."） |
| `OralExamPartFiveAnswerView` | 填空答题区 | 填空输入框列表 |

### 上区域 Cell 类型

| Cell | 用途 | 显示内容 |
|------|------|---------|
| `OralExamReadAloudCell` | 短文朗读 | 短文文本内容 |
| `OralExamChooseQuestionCell` | 选择题（答题中） | 题目 + 选项列表 |
| `OralExamPartFiveCell` | 通用小题显示 | 题目 + 图片 + 填空 |
| `CTExamRevisalShowQuestionsCell` | 情景问答/口头作文 | 问题内容 |
| `CTExamRevisalShowSixQuestionsCell` | 单句练习/题型8 | 句子内容 |

---

## 状态标志说明

| 标志 | 含义 |
|------|------|
| `isReadType` | 是否已完成阅读准备 |
| `isPlayVoice` | 是否已播放主音频 |
| `preReadShowType` | 是否已显示预览 |
| `beginSmallQuesionType` | 是否开始小题答题 |
| `firstNirraVoiceType` | 是否已播放第一段描述音频 |
| `secondNirraVoiceType` | 是否已播放第二段描述音频 |
| `prepareType` | 是否已完成准备阶段 |
| `diVoiceType` | 是否已播放"嘀"声提示 |
| `firstLuYinType` | 是否已完成第一次录音 |
| `secondvoiceType` | 是否已播放第二段音频 |

---

## 录音引擎模式

| Task 模式 | 说明 | 适用题型 |
|----------|------|---------|
| C | 段落评测 | partType 1, 5, 12 |
| E | 文章朗读评测 | partType 1, 6, 8（朗读部分） |
| B | 情景问答（JSGF语法） | partType 3, 8（问答部分） |
| H | 口头选择 | partType 2 |
| G | 单词评测（可得音标分数） | partType 7 |

---

## 评测结果处理

录音完成后，通过 `EngineManagerDelegate` 回调处理：

```objc
- (void)onBeginOral       // 录音开始
- (void)onUpdateVolume    // 音量更新
- (void)onEndOral:        // 录音结束，包含评测结果
- (void)onResult:         // 评测结果（启蒙者引擎）
```

评测结果包含：准确度(accuracy)、流利度(fluency)、完整度(integrity) 等维度分数。

---

## 录音引擎详解

### 引擎类型
系统支持两种录音引擎，通过 `isEngineType` 全局变量控制：

| 引擎 | 变量 | 特点 |
|------|------|------|
| 云知声 SDK | `isEngineType = NO` | 使用 `EngineManager`，默认引擎 |
| 启蒙者 SDK | `isEngineType = YES` | 使用 `KYTestEngine` |

### 评测模式对照表

| Task | coreType | qType | 适用场景 | 描述 |
|------|----------|-------|---------|------|
| E | KYTestType_Paragraph | 0 | 短文/段落朗读 | 逐词评分，支持单词分数 |
| B | KYTestType_Open | 6 | 情景问答 | JSGF 语法，支持关键词评分 |
| C | KYTestType_Open | 4/7 | 口头作文/转述 | 开放式评测 |
| G | - | - | 单词朗读 | 可获得音标分数 |
| H | KYTestType_Choice | - | 口头选择 | 多选项识别 |

### 录音生命周期

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   空闲      │───►│   录音中    │───►│   处理中    │───►│ 完成/错误   │
│   Idle      │    │  Recording  │    │  Processing │    │   Done      │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                  │                                     │
       │                  │                                     │
       └──────────────────┴────────────── resetToIdle ──────────┘
```

### 关键回调

```objc
// EngineManager 回调
- (void)onBeginOral                    // 录音真正开始（在此启用按钮交互）
- (void)onUpdateVolume:(int)volume     // 音量更新（每秒一次）
- (void)onEndOral:(NSError *)error     // 录音结束+评测完成
- (void)handleEngineResult:audioURL:savePath:  // 处理评测结果

// KYTestEngine 回调
- (void)onResult:(NSString *)result    // 启蒙者引擎评测结果
```

### 录音启动流程

```
1. 检查麦克风权限 [Tools checkCameraAuthorizationGrand:]
   ├── 有权限 → 继续
   └── 无权限 → 显示授权提示 [CTSharedView showAuthAgainAudioView:]
                 设置 model.checkAudioAuthType = YES

2. 禁用按钮交互 [self buttonUserInteractionEnabled:NO]

3. 设置引擎参数
   - self.engineUserTask = @"X"  // 评测模式
   - self.engineUserText = @"..."  // 评测文本

4. 启动录音
   ├── isEngineType = YES → [KYTestEngine startEngineWithTestConfig:]
   └── isEngineType = NO  → [EngineManager startRecognizeWithBeginOral:]

5. 收到 onBeginOral 回调
   - 启用按钮交互 [self buttonUserInteractionEnabled:YES]
   - 启动录音倒计时 Timer

6. 录音中...（倒计时/手动结束）

7. 停止录音 [self stopEngine]
   - 显示 HUD "正在评测中，请稍候"
   - self.scoreIngType = YES

8. 收到评测结果
   - 处理分数数据
   - 保存录音文件
   - 进入下一步/下一题
```

---

## 状态机说明

### 全局状态变量

| 变量 | 类型 | 说明 |
|------|------|------|
| `showTipIndex` | NSInteger | 当前大题索引 |
| `showTipTipIndex` | NSInteger | 当前小题索引 |
| `cancleType` | BOOL | 是否取消录音 |
| `pasueType` | BOOL | 是否暂停播放 |
| `applicationBack` | BOOL | 是否在后台 |
| `applicationCancleEngineType` | BOOL | 后台取消录音标志 |
| `scoreIngType` | BOOL | 正在评测中 |
| `jumpBigQuetionType` | BOOL | 跳到下一大题 |
| `backType` | BOOL | 返回标志 |
| `fiveType` | BOOL | 题型5特殊标志 |
| `submitType` | BOOL | 已提交试卷 |
| `autoSubmit` | BOOL | 自动提交（非手动点击） |

### OralExamQestionModel 状态标志

| 属性 | 说明 | 初始值 |
|------|------|-------|
| `isReadType` | 已完成阅读准备 | NO |
| `isPlayVoice` | 已播放主音频 | NO |
| `preReadShowType` | 已显示预览 | NO |
| `beginSmallQuesionType` | 开始小题答题 | NO |
| `firstNirraVoiceType` | 已播放第一段描述音频 | NO |
| `secondNirraVoiceType` | 已播放第二段描述音频 | NO |
| `prepareType` | 已完成准备阶段 | NO |
| `diVoiceType` | 已播放"嘀"声 | NO |
| `firstLuYinType` | 已完成第一次录音 | NO |
| `secondvoiceType` | 已播放第二段音频 | NO |
| `playCount` | 当前播放遍数 | 0 |
| `firstCount` | 第一阶段播放次数 | 配置值 |
| `secondCount` | 第二阶段播放次数 | 配置值 |

### 核心状态转换方法

```objc
// 音频播放结束 - 状态转换核心
- (void)audioPlayerDidFinishPlaying:(AVAudioPlayer *)player successfully:(BOOL)flag
{
    // 根据 model.partType 分发到对应的处理方法
    if (model.partType == 1) [self partOnePlayEnd:model];
    if (model.partType == 2) [self partTwoPlayEnd:model];
    // ...
}

// 切换到下一大题
- (void)changeOpenPart
{
    // 检查是否还有题目
    if (self.showTipIndex < self.testExamArrays.count) {
        // 显示题型介绍页
        [self addIntroduceVC:model];
    } else {
        // 考试结束
        [self pushExamEndVC];
    }
}

// 跳到下一大题（跳过当前大题剩余小题）
- (void)jumpNextBigQuestion
{
    // 找到下一个 superPartIndex 不同的题目
    self.showTipTipIndex = 0;
    // 更新 showTipIndex
    [self changeOpenPart];
}
```

---

## 错误处理

### 录音错误处理

```objc
// 录音引擎错误回调
- (void)error:(NSError *)error
{
    [JDProgressHUD dismiss];
    [self removeAllTimer];
    NSString *savePath = error.userInfo[@"savePath"];
    self.voicePath = savePath;
    [self dealWithLuYingError:self.voicePath];
}
```

### 常见错误码

| 错误码 | 说明 | 处理方式 |
|--------|------|---------|
| 100 | 麦克风权限被拒绝 | 显示授权提示 |
| 101 | 音频会话错误 | 重试 |
| 102 | SDK 初始化失败 | 显示错误提示 |
| 103 | 网络错误 | 保存本地，稍后重试 |
| 104 | 超时 | 使用空结果继续 |

### 应用生命周期处理

```objc
// 进入后台
- (void)ctApplicationWillResign
{
    self.applicationBack = YES;
    // 暂停音频播放
    if (self.pasueType == NO && self.audioPlayer != nil) {
        [self.audioPlayer pause];
    }
    // 处理录音状态
    if (self.scoreIngType) {
        // 正在评测中，等待完成
    } else if ([self.enManager isEngineRecording]) {
        // 正在录音，取消录音
        self.applicationCancleEngineType = YES;
        [self.enManager cancelRecognize];
    } else {
        // 暂停计时器
        [_jdTimer pauseTimer];
    }
}

// 回到前台
- (void)ctApplicationDidBecomeActive
{
    // 延迟处理，等待应用完全激活
    self.seekAppTimer = [JDTimer scheduledTimerWithTimeInterval:0.15 ...];
    // 在回调中调用 appInBackGroundMethods
}

// 后台返回处理
- (void)appInBackGroundMethods
{
    if (self.applicationBackDic || self.applicationBackError) {
        // 有缓存的评测结果，处理结果
        [self onEndOral:self.applicationBackError];
    } else if (self.applicationCancleEngineType) {
        // 录音被取消，重新开始录音
        self.applicationCancleEngineType = NO;
        // 根据题型重新启动录音...
    } else {
        // 恢复播放和计时器
        if (self.pasueType == NO && self.audioPlayer != nil) {
            [self.audioPlayer play];
        }
        [_jdTimer resumeTimer];
    }
}
```

---

## 数据结构

### 答案保存结构

```objc
// bSaveScoreArrays - 用于上传的分数数据
@[
    @{
        @"guid": @"题目唯一ID",
        @"partType": @(1),
        @"origiScore": @(满分),
        @"trueScore": @"实际得分",
        @"Questions": @[
            @{
                @"oid": @(小题ID),
                @"rightAnswer": @"正确答案",
                @"userAnswer": @"用户答案",
                @"isRight": @"True/False",
                @"trueScore": @"得分"
            }
        ]
    }
]

// bSaveDetailScoreArrays - 用于显示的详细数据
@[
    @{
        @"guid": @"题目唯一ID",
        @"partType": @(1),
        @"title": @"题目标题",
        @"Question": @[
            @{
                @"oid": @"小题序号",
                @"Current": @"用户答案",
                @"Standard": @"正确答案",
                @"trueScore": @"得分"
            }
        ]
    }
]
```

### 时间参数说明

| 参数 | 说明 | 适用题型 |
|------|------|---------|
| `readTimes` | 阅读准备时间（秒） | 1,2,3,4,5,6,8,12 |
| `finishTimes` | 录音时间/答题时间（秒） | 所有口语题型 |
| `repostTimes` | 转述录音时间（秒） | 5,12 |
| `firstReadyTimes` | 第一阶段准备时间 | 8 |
| `firstFinishTimes` | 第一阶段录音时间 | 8 |
| `secondReadyTimes` | 第二阶段准备时间 | 5,12 |
| `eachReadTimes` | 每小题准备时间 | 8 |
| `eachFinishTimes` | 每小题录音时间 | 8 |
| `firstCount` | 第一阶段播放次数 | 5 |
| `secondCount` | 第二阶段播放次数 | 5,12 |

---

## 按钮状态管理

### 下一步按钮样式

```objc
// 普通样式 - 橙色边框
self.nextBtn.layer.borderColor = CTRGBColor(255, 147, 0).CGColor;
[self.nextBtn setTitleColor:CTRGBColor(255, 147, 0) forState:UIControlStateNormal];
[self.nextBtn setTitle:@"下一步" forState:UIControlStateNormal];

// 提交样式 - 渐变背景
[self.nextBtn setBackgroundImage:[UIImage imageNamed:@"jianbian_juse"] forState:UIControlStateNormal];
[self.nextBtn setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];
[self.nextBtn setTitle:@"提交" forState:UIControlStateNormal];
```

### 按钮交互控制

```objc
// 录音开始前禁用按钮（防止竞态条件）
- (void)buttonUserInteractionEnabled:(BOOL)type
{
    if (type == NO) {
        // 立即禁用
        self.nextBtn.userInteractionEnabled = NO;
        self.nextBigQestionBtn.userInteractionEnabled = NO;
        self.recordVC.endButton.userInteractionEnabled = NO;
    } else {
        // 延迟1.2秒启用（等待引擎稳定）
        dispatch_after(1.2s, ^{
            self.nextBtn.userInteractionEnabled = YES;
            self.nextBigQestionBtn.userInteractionEnabled = YES;
            self.recordVC.endButton.userInteractionEnabled = YES;
        });
    }
}
```

---

## 文件保存

### 录音文件路径

```objc
// 录音文件保存在 Documents 目录下
// 格式：Documents/ExamVoice/[试卷文件夹]/[时间戳]/[题目ID].mp3

NSString *basePath = [Tools getExamOralFilePath:[BaseUser shared].currentChooseFileName];
NSString *voicePath = [basePath stringByAppendingPathComponent:self.creartFolderTimer];
// self.creartFolderTimer 在考试开始时生成，格式为时间戳
```

### 音频资源路径

```objc
// 试卷音频资源路径
NSString *audioPath = [[Tools getExamOralFilePath:[BaseUser shared].currentChooseFileName]
                        stringByAppendingPathComponent:model.voice];

// 系统音效路径（如"嘀"声）
NSString *beepPath = [[NSBundle mainBundle] pathForResource:@"beijing_di" ofType:@"mp3"];
```

---

## 调试日志

代码中包含大量 `NSLog` 和 `CTLOG` 日志，关键标识：

| 日志前缀 | 说明 |
|----------|------|
| `CTLOG-nextAction-` | 下一步按钮处理 |
| `CTLOG-Timer-` | 计时器相关 |
| `CTLOG-stopEngine-` | 停止引擎相关 |
| `CTLOG-partXXX-` | 各题型处理 |
| `hearAnswerClearUp` | 听力答案整理 |

---

## 相关文件

| 文件 | 说明 |
|------|------|
| `OralExamQestionModel.h/m` | 题目数据模型 |
| `OralExamScreenQuestionMOdel.h/m` | 小题数据模型 |
| `OralExamAnswerModel.h/m` | 答案选项模型 |
| `DrawLineModel.h/m` | 连线/排序/填空模型 |
| `EngineManager.h/m` | 录音引擎管理器 |
| `JDCardView.h/m` | 听力题型卡片视图 |
| `ExamQuestionTypeIntrducationView.h/m` | 题型介绍页 |
| `OralExamPlaySysReadSoundVC.h/m` | 音频播放控制器 |
| `OralExamRecordVC.h/m` | 录音状态控制器 |
| `OralExamReadQuestionVC.h/m` | 阅读准备控制器 |
| `OralExamPartTheReadVC.h/m` | 通用倒计时控制器 |
| `OralExamPartThrPlayQuestionVC.h/m` | 带提示的音频播放器 |
| `OralExamPartFiveAnswerView.h/m` | 填空答题视图 |
| `OralExamWordView.h/m` | 单词展示视图 |
| `OralExamContentView.h/m` | 短文内容视图 |
