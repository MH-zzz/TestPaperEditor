# 题型流程操作手册（听后选择）

## 1. 文档目标与边界

目标：让编辑人员在不看代码的前提下，稳定完成以下三件事：

1. 编辑题目内容（Question Data）。
2. 编辑流程模块（Flow Module）。
3. 编辑路由规则（Flow Profile）。

边界：本手册只针对 Demo 最新链路，不考虑兼容旧流程。

---

## 2. 三类角色与上手标准

### 2.1 题目编辑员（Content）

1. 目标上手时长：30 分钟。
2. 必须独立完成：建题、填充题组与小题、预览、保存入库。
3. 通过标准：可稳定产出 1 道可运行题目。

### 2.2 流程编辑员（Flow）

1. 目标上手时长：60 分钟。
2. 必须独立完成：克隆流程、改步骤、发布版本。
3. 通过标准：发布后预览执行顺序符合预期。

### 2.3 路由配置员（Routing）

1. 目标上手时长：45 分钟。
2. 必须独立完成：配规则、跑模拟器、修复诊断、提交生效。
3. 通过标准：规则无冲突/死规则，并可解释命中原因。

---

## 3. 统一工作流（强约束）

### 3.1 先编辑题目，再编辑流程，再编辑路由

1. 内容是流程和路由的输入，必须先稳定。
2. 流程版本发布后，路由才有意义。
3. 路由提交必须通过诊断闸门（冲突、死规则、弱覆盖）。

### 3.2 单向责任

1. `编辑` 页：只改题目内容，不改流程步骤。
2. `流程` 页：只改步骤与参数，不改题目正文。
3. `路由` 页：只改命中策略，不改流程定义。

---

## 4. 题目编辑 SOP（编辑页）

### 4.1 必填内容清单

1. 题目标题与标题补充。
2. 题组标题、题组提示。
3. 描述音频/正文音频（按题型需要）。
4. 题组准备时间、题组答题时间。
5. 小题与选项、正确答案。

### 4.2 保存规则

1. 点击保存时会先走统一校验。
2. 校验不通过：阻断保存，并给字段级错误。
3. 校验通过：保存草稿并更新最近题库快照。

### 4.3 自检标准

1. 手机预览可完整跑完步骤。
2. 答题步骤显示的小题与分组正确。
3. 音频缺失场景有明确提示文案，不出现空白页。

---

## 5. 流程编辑 SOP（流程中心）

### 5.1 修改入口

进入 `流程 -> 听后选择`，界面分三栏：

1. 左栏：题型模板数据（核对输入数据）。
2. 中栏：流程步骤图（编辑步骤、参数、顺序）。
3. 右栏：手机预览与执行效果验证。

### 5.2 版本策略

1. `保存题型流程`：保存草稿（`draft`），可继续修改。
2. `发布当前版本`：发布为 `published`，供路由绑定。
3. 已发布版本要变更：必须 `另存新版本` 后再发布。
4. 历史版本不再使用时：归档为 `archived`。

### 5.3 发布前必看

1. 差异摘要（步骤变化/参数变化/影响规则）是否合理。
2. 手机预览是否与预期一致。
3. 发布备注是否说明“适用地区/场景/变更原因”。

---

## 6. 路由编辑 SOP（路由中心）

### 6.1 每条规则必须完整

1. 命中条件：`region + scene + grade`（可按需求留空兜底）。
2. 优先级：用于冲突裁决。
3. 目标模块版本：必须是已发布版本。
4. 备注：说明规则目的与业务背景。

### 6.2 提交前强制诊断

系统会自动输出：

1. 冲突规则（conflicts）。
2. 潜在死规则（dead rules）。
3. 弱覆盖提示（weak coverage）。
4. 可提交状态（submit gate）。

未通过时禁止提交，必须先修复或应用修复建议。

### 6.3 模拟器使用标准

1. 输入地区/场景/年级后，查看 TopN 候选。
2. 必须能解释最终命中的得分明细（region/scene/grade/priority）。
3. 变更后重复模拟至少 1 次，确认命中仍正确。

---

## 7. 运行时调试与排障

### 7.1 优先看什么

1. 当前命中的 `profile -> module@version`。
2. step timeline（步骤迁移轨迹）。
3. 自动事件触发点（audioEnded/countdownEnded/timeEnded）。

### 7.2 常见问题快速定位

1. “命中错路由”：先看路由得分拆解是否被高优先级覆盖。
2. “步骤跳转异常”：看 runtime trace 是否触发了错误事件。
3. “预览与演练不一致”：确认是否走统一 runtime 入口。

---

## 8. 每日交付前 Checklist

1. 至少完成一次手机预览全流程。
2. 流程变更有版本备注与差异摘要。
3. 路由变更通过诊断闸门。
4. 关键改动后执行 `node --test` 并通过。

---

## 9. 文档维护规则

出现以下任一情况，必须同步更新本手册：

1. 流程步骤结构或语义变化。
2. 保存/发布/归档行为变化。
3. 路由诊断项或提交规则变化。
4. 调试入口与排障路径变化。

---

## 10. 变更记录

1. 2026-02-12：重写为 VNext 单链路版，补齐题目/流程/路由三角色 SOP 与提交前 Checklist。
